import 'package:test/test.dart';

void main() {
  test("secretMap", () {
    String js =
        r'var tDPrZXZ1=window["\x64\x6f\x63\x75\x6d\x65\x6e\x74"]["\x67\x65\x74\x45\x6c\x65\x6d\x65\x6e\x74\x42\x79\x49\x64"]("\x61\x63\x6f\x6e\x74\x65\x6e\x74\x7a")["\x69\x6e\x6e\x65\x72\x48\x54\x4d\x4c"];tDPrZXZ1=tDPrZXZ1["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\u201c","\x67\x69"),"\u300c")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\u201d","\x67\x69"),"\u300d")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\u2018","\x67\x69"),"\u300e")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\u2019","\x67\x69"),"\u300f")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue82c","\x67\x69"),"\u7684")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue836","\x67\x69"),"\u4e00")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue852","\x67\x69"),"\u662f")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue850","\x67\x69"),"\u4e86")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue832","\x67\x69"),"\u6211")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue812","\x67\x69"),"\u4e0d")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue833","\x67\x69"),"\u4eba")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue849","\x67\x69"),"\u5728")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue821","\x67\x69"),"\u4ed6")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue810","\x67\x69"),"\u6709")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue84c","\x67\x69"),"\u8fd9")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue815","\x67\x69"),"\u4e2a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue842","\x67\x69"),"\u4e0a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue82e","\x67\x69"),"\u4eec")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue817","\x67\x69"),"\u6765")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue835","\x67\x69"),"\u5230")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue837","\x67\x69"),"\u65f6")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue82d","\x67\x69"),"\u5927")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue859","\x67\x69"),"\u5730")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue85c","\x67\x69"),"\u4e3a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue82f","\x67\x69"),"\u5b50")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue84d","\x67\x69"),"\u4e2d")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue854","\x67\x69"),"\u4f60")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue81e","\x67\x69"),"\u8bf4")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue853","\x67\x69"),"\u751f")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue80f","\x67\x69"),"\u56fd")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue80e","\x67\x69"),"\u5e74")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue813","\x67\x69"),"\u7740")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue802","\x67\x69"),"\u5c31")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue81a","\x67\x69"),"\u90a3")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue83b","\x67\x69"),"\u548c")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue851","\x67\x69"),"\u8981")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue82a","\x67\x69"),"\u5979")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue838","\x67\x69"),"\u51fa")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue808","\x67\x69"),"\u4e5f")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue83a","\x67\x69"),"\u5f97")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue814","\x67\x69"),"\u91cc")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue857","\x67\x69"),"\u540e")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue855","\x67\x69"),"\u81ea")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue800","\x67\x69"),"\u4ee5")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue81b","\x67\x69"),"\u4f1a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue85f","\x67\x69"),"\u5bb6")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue816","\x67\x69"),"\u53ef")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue83e","\x67\x69"),"\u4e0b")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue84f","\x67\x69"),"\u800c")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue80b","\x67\x69"),"\u8fc7")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue828","\x67\x69"),"\u5929")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue843","\x67\x69"),"\u53bb")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue806","\x67\x69"),"\u80fd")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue81f","\x67\x69"),"\u5bf9")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue834","\x67\x69"),"\u5c0f")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue81c","\x67\x69"),"\u591a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue848","\x67\x69"),"\u7136")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue830","\x67\x69"),"\u4e8e")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue84b","\x67\x69"),"\u5fc3")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue84a","\x67\x69"),"\u5b66")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue85d","\x67\x69"),"\u4e48")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue861","\x67\x69"),"\u4e4b")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue809","\x67\x69"),"\u90fd")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue80c","\x67\x69"),"\u597d")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue84e","\x67\x69"),"\u770b")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue858","\x67\x69"),"\u8d77")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue840","\x67\x69"),"\u53d1")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue85b","\x67\x69"),"\u5f53")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue863","\x67\x69"),"\u6ca1")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue839","\x67\x69"),"\u6210")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue827","\x67\x69"),"\u53ea")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue841","\x67\x69"),"\u5982")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue805","\x67\x69"),"\u4e8b")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue845","\x67\x69"),"\u628a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue820","\x67\x69"),"\u8fd8")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue83c","\x67\x69"),"\u7528")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue847","\x67\x69"),"\u7b2c")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue819","\x67\x69"),"\u6837")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue82b","\x67\x69"),"\u9053")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue80a","\x67\x69"),"\u60f3")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue822","\x67\x69"),"\u4f5c")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue85e","\x67\x69"),"\u79cd")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue801","\x67\x69"),"\u5f00")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue856","\x67\x69"),"\u7f8e")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue811","\x67\x69"),"\u4e73")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue860","\x67\x69"),"\u9634")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue80d","\x67\x69"),"\u6db2")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue83f","\x67\x69"),"\u830e")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue803","\x67\x69"),"\u6b32")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue804","\x67\x69"),"\u547b")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue825","\x67\x69"),"\u8089")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue846","\x67\x69"),"\u4ea4")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue85a","\x67\x69"),"\u6027")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue831","\x67\x69"),"\u80f8")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue81d","\x67\x69"),"\u79c1")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue826","\x67\x69"),"\u7a74")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue818","\x67\x69"),"\u6deb")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue823","\x67\x69"),"\u81c0")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue829","\x67\x69"),"\u8214")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue807","\x67\x69"),"\u5c04")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue862","\x67\x69"),"\u8131")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue83d","\x67\x69"),"\u88f8")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue824","\x67\x69"),"\u9a9a")["\x72\x65\x70\x6c\x61\x63\x65"](new window["\x52\x65\x67\x45\x78\x70"]("\ue844","\x67\x69"),"\u5507");window["\x64\x6f\x63\x75\x6d\x65\x6e\x74"]["\x67\x65\x74\x45\x6c\x65\x6d\x65\x6e\x74\x42\x79\x49\x64"]("\x61\x63\x6f\x6e\x74\x65\x6e\x74\x7a")["\x69\x6e\x6e\x65\x72\x48\x54\x4d\x4c"]=tDPrZXZ1;';
    // \(["'](\\[a-z0-9]{4})["'],"\\x67\\x69"\),"(.*?)"\)
    RegExp reg = RegExp(
        r"""new window\["\\x52\\x65\\x67\\x45\\x78\\x70"\]\(['"](.*?)['"],['"]\\x67\\x69['"]\),['"](.*?)['"]\)""");
    var results = reg.allMatches(js).toList();
    StringBuffer sb = StringBuffer();
    sb.write("{");
    sb.write("\n");
    for (int i = 0; i < results.length; i++) {
      var match = results[i];
      var first = match.group(1);
      var second = match.group(2);
      sb.write('  "$first": "$second"');
      if (i != results.length - 1) {
        sb.write(',');
      }
      sb.write('\n');
    }
    sb.write('}');
    print(sb);
  });

  test("_sanitizeFileName", () {
    List<String> filenames = [
      "问题儿童都来自异世界?",
      "16:00的召唤魔法",
      "未踏召唤:／／鲜血印记",
      "Fate/Strange Fake",
      ".123456."
    ];
    for (var filename in filenames) {
      print(_sanitizeFileName(filename));
    }
  });

  test("eval", () {
    int result = _eval("0x184d+0x19af+-0x31e8");
    print(result);
  });
}

int _eval(String expression) {
  List<String> hexNums = expression.split("+");
  int result = 0;
  for (var n in hexNums) {
    n = n.replaceFirst("0x", "");
    int num = int.parse(n, radix: 16);
    result += num;
  }
  return result;
}

String _sanitizeFileName(String name) {
  var keywords = {":", "*", "?", "\"", "\\", "/", "<", ">", "|", "\\0", "　"};
  for (var keyword in keywords) {
    name = name.replaceAll(keyword, " ");
  }
  if (name.startsWith(".")) {
    name = name.substring(1);
  }
  if (name.endsWith(".")) {
    name = name.substring(0, name.length - 1);
  }
  // 替换连续空格为一个空格
  name = name.replaceAllMapped(RegExp("\\s+"), (_) => " ");
  return name.trim();
}
